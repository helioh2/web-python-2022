{% extends 'base.html' %}

{% block conteudo %}
<h1>{% block title %} Lista de contatos {% endblock %}</h1>

{% set page_atual = request.args.get("page")|int if request.args.get("page") else 1  %}

<form action="#" class="form-group">
    <label for="busca">Busca: </label>
    <input onkeyup="buscar();" type="text" class="form-control" id="busca" name="busca">
</form>


<table class="table table-striped">
    <thead>
    <tr> <th>Nome</th> <th>Telefone</th> <th>Data de Nascimento</th> </tr>
    </thead>

    <tbody>
    {% for contato in contatos.items %}
        <tr>
            <td>{{contato.nome}}</td>
            <td>{{contato.telefone}}</td>
            <td>{{contato.data_nascimento.strftime("%d/%m/%Y")}}</td>
            <td><a href="{{url_for('remover_contato_action')}}?id={{contato.id}}"><span class="glyphicon glyphicon-trash"></a></td>
            <td><a href="{{url_for('alterar_contato_form')}}?id={{contato.id}}">Alterar</a></td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<ul class="pagination">
    {% for i in range(1, contatos.pages + 1) %}
        <li
        {% if page_atual and page_atual == i %}class="active"{% endif %}
        ><a href="/contatos?page={{i}}">{{i}}</a></li>
    {% endfor %}
  </ul>

<p><a href="{{ url_for('adicionar_contato_form') }}">Adicionar Contato</a></p>


<script>

    function buscar(){

        buscaStr = document.getElementById("busca").value;
        console.log(buscaStr);

       // Create an XMLHttpRequest object
       const xhttp = new XMLHttpRequest();

       //FUNÇÃO CALLBACK
       xhttp.onload = function() {
            json = JSON.parse(this.responseText);
       }

       sendRequest = function() {
            xhttp.open("GET", "contatos_json?busca="+buscaStr);
            xhttp.send(); 
       }

       sendRequest();

    }

</script>

{% endblock %}

